<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SISACREP — Sistema de Información para la Agricultura y la Pesca (Prototipo)</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --blue-700:#2563eb;
      --blue-500:#3b82f6;
      --green-700:#16a34a;
      --green-500:#34d399;
      --bg:#ffffff;
      --card:#ffffffcc;
      --muted:#6b7280;
      --accent-blue:#1e40af;
      --accent-green:#065f46;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#ecfdf5 0%, #eff6ff 100%);color:#0f172a}
    .container{max-width:1100px;margin:24px auto;padding:18px}
    header{background:linear-gradient(90deg,var(--green-700),var(--blue-700));color:white;padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.08)}
    header h1{margin:0;font-size:1.6rem}
    header p{margin:6px 0 0;font-size:0.95rem;opacity:0.95}
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:16px}
    @media(min-width:900px){ .grid{grid-template-columns:2fr 1fr  } }
    .card{background:var(--card);border-radius:10px;padding:14px;box-shadow:0 4px 12px rgba(2,6,23,0.06);border-top:4px solid #e6eefb}
    .card h3{margin:0 0 8px;color:var(--accent-blue)}
    .stats{display:flex;gap:12px;flex-wrap:wrap}
    .stat{flex:1;min-width:110px;background:#ffffffcc;border-radius:8px;padding:8px;text-align:center}
    .stat strong{display:block;font-size:1.25rem}
    .muted{color:var(--muted);font-size:0.9rem}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:var(--green-700);color:white;border:none;cursor:pointer}
    .btn.blue{background:var(--blue-700)}
    .select, select, input[type="text"], input[type="password"]{width:100%;padding:8px;border-radius:8px;border:1px solid #e6eefb;margin-top:6px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .col{flex:1}
    .section-title{display:flex;align-items:center;gap:8px;margin-bottom:8px}
    .map-wrap{display:flex;gap:12px;flex-direction:column}
    @media(min-width:900px){ .map-wrap{flex-direction:row} }
    .map{flex:1;background:linear-gradient(180deg,#f0f9ff,#f0fff4);border-radius:10px;padding:10px;min-height:260px}
    .legend{width:260px;background:#fff;padding:12px;border-radius:10px}
    .legend-item{display:flex;gap:8px;align-items:flex-start;margin-bottom:8px}
    .dot{width:14px;height:14px;border-radius:3px;border:1px solid rgba(0,0,0,0.08);margin-top:3px}
    footer{text-align:center;margin-top:18px;color:var(--muted);font-size:0.9rem}
    .panel-tech{background:linear-gradient(90deg,#f8fafc,#ffffff);padding:12px;border-radius:8px;border:1px solid #eaeef6}
    .list{padding-left:18px}
    .small{font-size:0.9rem;color:var(--muted)}
    .save{margin-top:8px}
    .hidden{display:none}
    /* compact chart container */
    .chart-box{height:150px;width:100%;margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>SISACREP</h1>
      <p>Sistema de Información para la Agricultura y la Pesca — Repelón, Atlántico (Prototipo)</p>
      <p id="welcome" style="margin-top:8px;opacity:0.95;font-style:italic;display:none">Bienvenido(a), <span id="user-name"></span></p>
    </header>

    <!-- Main grid -->
    <div class="grid">

      <!-- Left: Dashboard / Charts / Recomendaciones -->
      <div>
        <!-- Clima -->
        <div class="card">
          <div class="section-title"><h3>Clima en tiempo real</h3></div>
          <div class="stats" style="margin-bottom:12px">
            <div class="stat">
              <div class="muted">Temperatura</div>
              <strong id="temp-val">28°C</strong>
            </div>
            <div class="stat">
              <div class="muted">Humedad</div>
              <strong id="hum-val">70%</strong>
            </div>
            <div class="stat">
              <div class="muted">Viento</div>
              <strong id="wind-val">12 km/h</strong>
            </div>
          </div>

          <div class="chart-box">
            <canvas id="chart"></canvas>
          </div>
        </div>

        <!-- Info y recomendaciones -->
        <div class="card" style="margin-top:12px">
          <div class="section-title"><h3>Información y Recomendaciones Generales (público)</h3></div>
          <div class="row">
            <div class="col">
              <h4 style="color:var(--green-700)">Agricultura — Recomendaciones</h4>
              <ul class="list">
                <li>Revisar humedad del suelo antes de sembrar.</li>
                <li>Usar cultivos de ciclo corto en temporadas de incertidumbre climática.</li>
                <li>Implementar riego temprano y mulching para reducir evaporación.</li>
                <li>Rotación de cultivos para mantener la fertilidad del suelo.</li>
              </ul>

              <div style="margin-top:10px">
                <label class="small">Temporada</label>
                <select id="season" class="select">
                  <option value="Lluviosa">Lluviosa</option>
                  <option value="Seco">Seco</option>
                </select>
                <label class="small" style="margin-top:8px">Tipo de suelo</label>
                <select id="soil" class="select">
                  <option value="Humedo">Húmedo</option>
                  <option value="Arenoso">Arenoso</option>
                  <option value="Arcilloso">Arcilloso</option>
                </select>

                <div style="margin-top:10px">
                  <strong>Cultivos recomendados</strong>
                  <ul id="crops" class="list"></ul>
                  <div id="save-prefs" class="save hidden">
                    <button id="save-btn" class="btn">Guardar preferencias (para usuarios registrados)</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="col">
              <h4 style="color:var(--blue-700)">Pesca — Recomendaciones</h4>
              <ul class="list">
                <li>Verificar viento y oleaje antes de salir a faenar.</li>
                <li>Usar redes selectivas y respetar vedas.</li>
                <li>Mantener equipos de seguridad: chalecos, linterna y botiquín.</li>
                <li>Reportar anomalías (algas, mortalidad) al panel técnico.</li>
              </ul>

              <div style="margin-top:8px">
                <strong>Especies recomendadas (por temporada)</strong>
                <ul id="species" class="list"></ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Panel técnico (solo simulado, aparece al iniciar sesión) -->
        <div id="panel-tech" class="card hidden" style="margin-top:12px">
          <div class="section-title"><h3>Panel Técnico (Administración) — acceso restringido</h3></div>
          <div class="panel-tech">
            <div style="display:flex;gap:10px;flex-wrap:wrap">
              <div style="flex:1;min-width:220px">
                <strong>Agregar nueva alerta</strong>
                <input id="alt-title" placeholder="Título de alerta" />
                <input id="alt-desc" placeholder="Descripción" style="margin-top:6px" />
                <button class="btn blue" style="margin-top:8px" id="publish-alert">Publicar alerta</button>
              </div>
              <div style="flex:1;min-width:220px">
                <strong>Actualizar recomendaciones</strong>
                <input id="rec-text" placeholder="Nueva recomendación" />
                <button class="btn" style="margin-top:8px" id="update-rec">Actualizar</button>
              </div>
              <div style="flex:1;min-width:220px">
                <strong>Monitoreo</strong>
                <p class="small">Simulación de registros y sincronización con API meteorológica.</p>
                <button class="btn blue" id="view-logs">Ver registros (simulado)</button>
              </div>
            </div>
            <p class="small" style="margin-top:10px;color:#374151">Consejo: los usuarios pueden guardar preferencias (temporada y suelo) para recibir recomendaciones personalizadas.</p>
          </div>
        </div>

      </div>

      <!-- Right column: Login + Alerts + Map summary -->
      <div>
        <!-- Login / Public Access -->
        <div class="card">
          <div class="section-title"><h3>Acceso de usuarios</h3></div>

          <div id="login-area">
            <label class="small">Nombre de usuario</label>
            <input id="username" type="text" placeholder="Digite su nombre" />

            <label class="small" style="margin-top:8px">Contraseña</label>
            <input id="pass" type="password" placeholder="(simulada)" />

            <div style="margin-top:10px">
              <button id="login-btn" class="btn">Iniciar sesión</button>
              <button id="logout-btn" class="btn blue hidden" style="margin-left:8px">Cerrar sesión</button>
            </div>

            <p class="small" style="margin-top:8px;color:var(--muted)">Acceso público limitado: la información básica y recomendaciones son visibles sin iniciar sesión.</p>
          </div>
        </div>

        <!-- Alertas -->
        <div class="card" style="margin-top:12px">
          <div class="section-title"><h3 style="color:var(--blue-700)">Alertas Climáticas</h3></div>
          <ul id="alerts-list" class="list">
            <!-- dinámico -->
          </ul>
        </div>

        <!-- Mini mapa / resumen -->
        <div class="card" style="margin-top:12px">
          <div class="section-title"><h3>Mapa de Condiciones (resumen)</h3></div>
          <div style="height:180px;display:flex;align-items:center;justify-content:center">
            <!-- small preview SVG -->
            <svg viewBox="0 0 100 100" style="width:100%;height:100%;border-radius:8px">
              <rect x="0" y="0" width="100" height="100" fill="#f8fafc" rx="6"/>
              <polygon points="10,70 40,60 45,80 15,85" fill="#d1fae5" stroke="#10b981" stroke-width="0.4"></polygon>
              <polygon points="55,65 75,60 80,78 60,82" fill="#d1fae5" stroke="#10b981" stroke-width="0.4"></polygon>
              <polygon points="20,20 40,18 45,32 22,35" fill="#dbf4ff" stroke="#2563eb" stroke-width="0.4"></polygon>
              <polygon points="68,28 86,26 88,40 70,44" fill="#dbf4ff" stroke="#2563eb" stroke-width="0.4"></polygon>
              <circle cx="25" cy="28" r="1.6" fill="#f59e0b" stroke="#b45309"></circle>
              <g transform="translate(50,35)"><circle r="2.2" fill="#fecaca" stroke="#dc2626"></circle><text x="0" y="0.5" font-size="2.6" text-anchor="middle" fill="#b91c1c">⚠</text></g>
            </svg>
          </div>
        </div>

      </div>

      <!-- Full width: Mapa ilustrado grande -->
      <div style="grid-column:1/-1;margin-top:12px">
        <div class="card">
          <div class="section-title"><h3>Mapa de Condiciones Locales</h3></div>
          <div class="map-wrap">
            <div class="map">
              <!-- SVG ilustrado (interactivo por título) -->
              <svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet" style="width:100%;height:100%">
                <rect x="0" y="0" width="100" height="100" fill="#f8fafc" />
                <!-- Zonas agrícolas -->
                <polygon points="10,70 40,60 45,80 15,85" fill="#d1fae5" stroke="#10b981" stroke-width="0.35"><title>Zona agrícola - La Cañada</title></polygon>
                <polygon points="55,65 75,60 80,78 60,82" fill="#d1fae5" stroke="#10b981" stroke-width="0.35"><title>Zona agrícola - El Carmen</title></polygon>
                <!-- Zonas pesqueras -->
                <polygon points="20,20 40,18 45,32 22,35" fill="#dbf4ff" stroke="#2563eb" stroke-width="0.35"><title>Zona pesquera - Ribera Norte</title></polygon>
                <polygon points="68,28 86,26 88,40 70,44" fill="#dbf4ff" stroke="#2563eb" stroke-width="0.35"><title>Zona pesquera - Ciénaga</title></polygon>
                <!-- Estaciones -->
                <circle cx="25" cy="28" r="1.6" fill="#f59e0b" stroke="#b45309"><title>Estación 1</title></circle>
                <circle cx="72" cy="30" r="1.6" fill="#f59e0b" stroke="#b45309"><title>Estación 2</title></circle>
                <circle cx="42" cy="68" r="1.6" fill="#f59e0b" stroke="#b45309"><title>Estación 3</title></circle>
                <!-- Alertas -->
                <g transform="translate(50,35)"><circle r="2.2" fill="#fecaca" stroke="#dc2626"></circle><text x="0" y="0.6" font-size="3" text-anchor="middle" fill="#b91c1c">⚠</text><title>Lluvia intensa</title></g>
                <g transform="translate(30,78)"><circle r="2.2" fill="#fecaca" stroke="#dc2626"></circle><text x="0" y="0.6" font-size="3" text-anchor="middle" fill="#b91c1c">⚠</text><title>Vientos fuertes</title></g>

                <!-- Leyenda -->
                <rect x="2" y="2" width="28" height="18" fill="#ffffffcc" stroke="#e5e7eb" rx="1"></rect>
                <text x="4" y="6" font-size="3" fill="#111827">Leyenda</text>
                <rect x="4" y="8" width="2" height="2" fill="#d1fae5" stroke="#10b981"></rect><text x="7.5" y="9.5" font-size="2.5" fill="#064e3b">Zona agrícola</text>
                <rect x="4" y="11" width="2" height="2" fill="#dbf4ff" stroke="#2563eb"></rect><text x="7.5" y="12.5" font-size="2.5" fill="#1e3a8a">Zona pesquera</text>
                <rect x="4" y="14" width="2" height="2" fill="#f59e0b" stroke="#b45309"></rect><text x="7.5" y="15.5" font-size="2.5" fill="#92400e">Estación de monitoreo</text>
                <text x="18" y="15.5" font-size="2.5" fill="#b91c1c">⚠ Alerta</text>
              </svg>
            </div>

            <div class="legend">
              <h4 style="margin:0 0 8px">Detalles del mapa</h4>
              <p class="small">Este mapa es una representación ilustrada de zonas agrícolas y pesqueras en el municipio de Repelón. Haga hover o pulse sobre elementos para ver títulos (en navegadores compatibles).</p>
              <div style="margin-top:10px">
                <div class="legend-item"><div class="dot" style="background:#d1fae5;border-color:#10b981"></div><div><strong>Zonas agrícolas</strong><div class="small">Recomendación: prever riego y rotación de cultivos.</div></div></div>
                <div class="legend-item"><div class="dot" style="background:#dbf4ff;border-color:#2563eb"></div><div><strong>Zonas pesqueras</strong><div class="small">Recomendación: verificar viento y oleaje antes de faenas.</div></div></div>
                <div class="legend-item"><div class="dot" style="background:#f59e0b;border-color:#b45309"></div><div><strong>Estaciones de monitoreo</strong><div class="small">Registra datos locales y reporte anomalías.</div></div></div>
                <div class="legend-item"><div class="dot" style="background:#fecaca;border-color:#dc2626"></div><div><strong>Alertas climáticas</strong><div class="small">Siga las indicaciones de seguridad y evite actividades riesgosas.</div></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <footer>
      © 2025 SISACREP — Proyecto Productivo SENA | Repelón, Atlántico
    </footer>
  </div>

  <script>
    // Simulated data & UI logic
    const sampleData = {
      dias: ['Lun','Mar','Mié','Jue','Vie'],
      temperatura: [30,29,31,32,28],
      humedad: [65,70,60,55,75]
    };

    // Render chart (Chart.js) - compact options
    const ctx = document.getElementById('chart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: sampleData.dias,
        datasets: [
          { label:'Temperatura (°C)', data: sampleData.temperatura, borderColor:'#2563eb', backgroundColor:'rgba(37,99,235,0.08)', tension:0.35, pointRadius:3, fill:true },
          { label:'Humedad (%)', data: sampleData.humedad, borderColor:'#16a34a', backgroundColor:'rgba(16,163,74,0.06)', tension:0.35, pointRadius:3, fill:false, yAxisID:'y1' }
        ]
      },
      options: {
        responsive:true,
        maintainAspectRatio:false,
        plugins:{legend:{position:'bottom'}},
        layout:{padding:{top:6,bottom:6}},
        scales:{
          y:{
            beginAtZero:false,
            ticks:{stepSize:5}
          },
          y1:{
            position:'right',
            grid:{display:false},
            beginAtZero:false
          }
        }
      }
    });

    // DOM refs
    const tempVal = document.getElementById('temp-val');
    const humVal = document.getElementById('hum-val');
    const windVal = document.getElementById('wind-val');
    const alertsList = document.getElementById('alerts-list');
    const cropsList = document.getElementById('crops');
    const speciesList = document.getElementById('species');
    const seasonSel = document.getElementById('season');
    const soilSel = document.getElementById('soil');
    const loginBtn = document.getElementById('login-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const usernameInput = document.getElementById('username');
    const welcome = document.getElementById('welcome');
    const userNameSpan = document.getElementById('user-name');
    const panelTech = document.getElementById('panel-tech');
    const savePrefsDiv = document.getElementById('save-prefs');
    const saveBtn = document.getElementById('save-btn');

    // Catalogs (same as prototype)
    const catalogoCultivos = {
      Lluviosa: { Humedo:['Yuca','Plátano','Arroz'], Arenoso:['Mijo','Fríjol de Suelo Arenoso'], Arcilloso:['Maíz','Cacao'] },
      Seco: { Humedo:['Ñame (con riego)','Batata'], Arenoso:['Sorgo','Cártamo'], Arcilloso:['Maíz de ciclo corto'] }
    };
    const catalogoPesca = { Lluviosa:['Tilapia (cría estable)','Mojarra'], Seco:['Bagre (captura selectiva)','Carpa'] };

    // Alertas & map items (simulated)
    let alertas = [
      {id:1, text:'Lluvias intensas previstas en zona norte.'},
      {id:2, text:'Vientos fuertes en la ciénaga del Guájaro.'},
      {id:3, text:'Alerta por alta radiación solar al mediodía.'}
    ];

    function renderAlerts(){
      alertsList.innerHTML = '';
      alertas.forEach(a=>{
        const li = document.createElement('li');
        li.textContent = a.text;
        alertsList.appendChild(li);
      });
    }

    function renderRecommendations(){
      const season = seasonSel.value;
      const soil = soilSel.value;
      const crops = (catalogoCultivos[season] && catalogoCultivos[season][soil]) || [];
      const species = catalogoPesca[season] || [];

      cropsList.innerHTML = '';
      crops.forEach(c=>{ const li = document.createElement('li'); li.textContent = c; cropsList.appendChild(li); });

      speciesList.innerHTML = '';
      species.forEach(s=>{ const li = document.createElement('li'); li.textContent = s; speciesList.appendChild(li); });
    }

    // Simulate "real-time" updates (random small variations)
    function randomizeMetrics(){
      const t = 25 + Math.round(Math.random()*10); // 25..35
      const h = 50 + Math.round(Math.random()*30); // 50..80
      const w = 5 + Math.round(Math.random()*15);  // 5..20
      tempVal.textContent = t + '°C';
      humVal.textContent = h + '%';
      windVal.textContent = w + ' km/h';
      // update chart data gently
      chart.data.datasets[0].data = chart.data.datasets[0].data.map((v,i)=> Math.round(sampleData.temperatura[i] + (Math.random()*2-1)));
      chart.data.datasets[1].data = chart.data.datasets[1].data.map((v,i)=> Math.round(sampleData.humedad[i] + (Math.random()*4-2)));
      chart.update();
    }

    // Login flow (simulated)
    function setLoggedIn(name){
      localStorage.setItem('sisacrep_user', name);
      document.querySelector('#login-area').classList.add('hidden'); // hide login inputs (if desired)
      logoutBtn.classList.remove('hidden');
      welcome.style.display = 'block';
      userNameSpan.textContent = name;
      panelTech.classList.remove('hidden');
      savePrefsDiv.classList.remove('hidden');
      document.getElementById('welcome').style.display = 'block';
      renderRecommendations();
    }

    function setLoggedOut(){
      localStorage.removeItem('sisacrep_user');
      document.querySelector('#login-area').classList.remove('hidden');
      logoutBtn.classList.add('hidden');
      welcome.style.display = 'none';
      userNameSpan.textContent = '';
      panelTech.classList.add('hidden');
      savePrefsDiv.classList.add('hidden');
    }

    // Events
    loginBtn.addEventListener('click',()=>{
      const name = usernameInput.value.trim() || 'Técnico SISACREP';
      setLoggedIn(name);
      // store in localStorage
      localStorage.setItem('sisacrep_user', name);
      // show welcome text
      userNameSpan.textContent = name;
      welcome.style.display = 'block';
      // show logout
      logoutBtn.classList.remove('hidden');
      loginBtn.classList.add('hidden');
    });

    logoutBtn.addEventListener('click',()=>{
      setLoggedOut();
      loginBtn.classList.remove('hidden');
      logoutBtn.classList.add('hidden');
    });

    document.getElementById('publish-alert').addEventListener('click',()=>{
      const title = document.getElementById('alt-title').value.trim();
      const desc = document.getElementById('alt-desc').value.trim();
      if(!title && !desc){ alert('Ingrese título o descripción para la alerta.'); return; }
      alertas.unshift({id:Date.now(), text: title ? title + (desc ? ' - '+desc : '') : desc});
      renderAlerts();
      alert('Alerta publicada (simulada).');
    });

    document.getElementById('update-rec').addEventListener('click',()=>{
      const rec = document.getElementById('rec-text').value.trim();
      if(!rec){ alert('Ingrese una recomendación.'); return; }
      // append to agriculture recommendations visually
      const ul = document.querySelector('.card ul.list');
      const li = document.createElement('li'); li.textContent = rec;
      // For demo, add to agriculture list
      document.querySelector('.card .list').appendChild(li);
      alert('Recomendación actualizada (simulada).');
    });

    document.getElementById('view-logs').addEventListener('click',()=>{
      alert('Mostrando registros (simulados).');
    });

    saveBtn && saveBtn.addEventListener('click',()=>{
      const name = localStorage.getItem('sisacrep_user') || 'usuario';
      const season = seasonSel.value, soil = soilSel.value;
      localStorage.setItem('sisacrep_prefs', JSON.stringify({name,season,soil,ts:Date.now()}));
      alert('Preferencias guardadas para ' + name);
    });

    seasonSel.addEventListener('change', renderRecommendations);
    soilSel.addEventListener('change', renderRecommendations);

    // Init
    renderAlerts();
    renderRecommendations();
    randomizeMetrics();
    setInterval(randomizeMetrics, 8000); // update metrics periodically
    // Restore session if exists
    const storedUser = localStorage.getItem('sisacrep_user');
    if(storedUser){
      usernameInput.value = storedUser;
      loginBtn.classList.add('hidden');
      logoutBtn.classList.remove('hidden');
      setLoggedIn(storedUser);
    }
  </script>
</body>
</html>
